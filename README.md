# D's Chatting App

## 术语

- 用户指令：客户端中用户的所有输入都会被解码，形成指令以及参数。指令分为本地指令和远程交互指令。
  - 本地指令：仅影响本地配置，不向服务器发送的指令。如修改存储的文件地址等
  - 远程交互指令：需要发送到服务器进行处理的指令，如查询在线的用户，给其他用户发送消息等


---

## 架构
### 客户端

分为四个线程，主线程，用户发送线程，接收消息线程，用户指令处理线程，文件交互线程。线程间通信使用queue

| 线程名    | 线程作用                         |
|--------|------------------------------|
| 主线程    | 接收用户输入并通知用户指令处理线程            |
| 用户发送线程 | 等待用户指令处理线程的激活，接管所有远程交互指令的后续  |
| 接收消息线程 | 接收所有来自服务器的消息并处理              |
| 文件交互线程 | 不定时启动，一旦接收消息进程接收到文件交互指令才会被创建 |

主要逻辑就是主线程循环获取用户的输入，分类并检查合法性后传递给用户指令处理进程，用户指令处理进程处理后传递给用户发送线程或创建文件交互或更新本地配置
接收消息进程独立地处理来自服务器的消息

从客户端启动到结束过程，发送消息和指令共用一个tcp连接，发送文件单开一个tcp连接
由于除了文件交互功能，都不需要上下文，所以发送线程发送后不再跟踪，接收消息线程接收到消息时默认发送过对应请求

用户的输入将被解码为指令与参数的形式，并处理为一个有两个元素的列表，无法被解码的将无视

原始输入直接提交给Operation的handleUserinput方法进行处理，目前有以下几种指令：
- $开头的本地配置指令
  - file指令，更新本地文件路径
- server指令，给服务器发送信息，有一个参数：要发送的信息
- to指令，给指定用户发送信息，有两个参数：要发送的用户id，内容
- query指令，查询在线的用户，没有参数
- file指令，向服务器文件缓存发送本地文件，参数不需要用户输入，直接调用配置的路径，如果没有配置就要求用户进行配置
- fileto指令，将缓存在服务器的文件发送给指定用户，有一个参数：用户id
### 服务端

---
